# 工作项详情查看功能 - 使用说明

## ✅ 新增功能

在Web界面中添加了点击查看工作项详情的功能，可以查看以下三个重要字段：

1. **description** - 描述
2. **wiki** - 需求文档URL
3. **field_4972f5** - 需求交付物清单

## 🎯 功能特性

### 1. 点击查看详情
- 表格中的每一行都可以点击
- 鼠标悬停时行背景变为浅蓝色
- 名称旁边显示"查看详情"提示

### 2. 详情模态框
- 弹出式模态框显示完整信息
- 包含所有基本字段和三个新增字段
- 支持点击外部或关闭按钮关闭

### 3. 字段展示
**基本信息**:
- 工作项ID
- 名称
- 所属业务线
- 关联项目
- 规划版本
- 优先级
- 需求状态
- 创建者
- 当前负责人

**详细信息**:
- 📝 **描述 (description)**: 多行文本，保留格式
- 🔗 **需求文档URL (wiki)**: 可点击的链接
- 📋 **需求交付物清单 (field_4972f5)**: 多行文本，保留格式

## 🚀 使用方法

### 方式1: 点击整行
1. 在工作项列表中找到目标工作项
2. 点击该行的任意位置
3. 弹出详情模态框

### 方式2: 点击"查看详情"
1. 在工作项名称旁边找到"查看详情"链接
2. 点击链接
3. 弹出详情模态框

### 关闭详情
- 点击右上角的 × 按钮
- 点击模态框外部的灰色区域
- 按 ESC 键（浏览器默认行为）

## 📊 数据加载

### 启动时加载
服务器启动时会自动加载所有数据，包括新增的三个字段：
```
================================================================================
✅ 数据加载完成!
   总记录数: 1175
   项目数: 72
   版本数: 232
   业务线数: 10
================================================================================
```

### 字段包含
默认查询字段已更新，包含：
- name - 名称
- field_c13a6c - 关联项目
- field_ab3f51 - 规划版本
- business - 所属业务线
- work_item_status - 需求状态
- priority - 优先级
- owner - 创建者
- current_status_operator - 当前负责人
- work_item_id - 工作项ID
- **description** - 描述 ⭐
- **wiki** - 需求文档URL ⭐
- **field_4972f5** - 需求交付物清单 ⭐

## 🎨 界面设计

### 模态框样式
- 现代化设计
- 平滑动画效果
- 响应式布局
- 清晰的字段分组

### 字段展示
- 每个字段独立区域
- 标签带有图标标识
- 空值显示为灰色斜体
- 链接可点击并在新标签打开
- 多行文本保留原始格式

### 交互反馈
- 行悬停高亮
- 点击动画
- 加载状态提示
- 错误信息显示

## 🔧 技术实现

### 后端改进

#### 1. 字段查询
`get_view_workitems.py` 第42-56行:
```python
fields = [
    "name",
    "field_c13a6c",
    "field_ab3f51",
    "business",
    "work_item_status",
    "priority",
    "owner",
    "current_status_operator",
    "work_item_id",
    "description",      # 新增
    "wiki",             # 新增
    "field_4972f5"      # 新增
]
```

#### 2. 字段解析
`get_view_workitems.py` 第282-288行:
```python
elif header == "描述":
    workitem["description"] = value
elif header == "需求文档URL":
    workitem["wiki"] = value
elif header == "需求交付物清单":
    workitem["field_4972f5"] = value
```

#### 3. 详情API
`web_app_v2.py` 新增接口:
```python
@app.route('/api/workitem/<work_item_id>')
def get_workitem_detail(work_item_id):
    # 从缓存中查找并返回工作项详情
```

### 前端改进

#### 1. 模态框HTML
`templates/index.html`:
- 添加模态框结构
- 添加详情展示区域

#### 2. 模态框CSS
- 模态框样式
- 动画效果
- 响应式设计

#### 3. JavaScript功能
- `showWorkitemDetail(workItemId)` - 显示详情
- `closeModal()` - 关闭模态框
- `escapeHtml(text)` - HTML转义

## 📝 使用示例

### 示例1: 查看工作项描述
1. 点击任意工作项
2. 在详情中查看"描述"字段
3. 如果有内容，显示完整的多行文本
4. 如果为空，显示"暂无描述"

### 示例2: 访问需求文档
1. 点击工作项查看详情
2. 找到"需求文档URL"字段
3. 如果有链接，点击在新标签打开
4. 如果为空，显示"暂无文档链接"

### 示例3: 查看交付物清单
1. 点击工作项查看详情
2. 找到"需求交付物清单"字段
3. 查看完整的交付物列表
4. 如果为空，显示"暂无交付物清单"

## 🆘 故障排除

### 问题1: 点击无反应
**解决方案**:
- 刷新页面
- 检查浏览器控制台是否有错误
- 确认服务器正常运行

### 问题2: 详情显示不完整
**解决方案**:
- 检查数据是否包含这些字段
- 查看服务器日志
- 确认API返回正常

### 问题3: 模态框无法关闭
**解决方案**:
- 点击右上角 × 按钮
- 点击模态框外部
- 刷新页面

## 📊 API接口

### 获取工作项详情
```
GET /api/workitem/<work_item_id>
```

**参数**:
- `work_item_id`: 工作项ID

**响应示例**:
```json
{
  "success": true,
  "data": {
    "work_item_id": "6745760107",
    "name": "工作项名称",
    "description": "详细描述内容...",
    "wiki": "https://example.com/doc",
    "field_4972f5": "交付物清单内容...",
    ...
  }
}
```

## 🔄 版本更新

### V2.1 (2026-01-27)
- ✅ 添加工作项详情查看功能
- ✅ 支持查看描述、文档URL、交付物清单
- ✅ 添加模态框展示
- ✅ 优化交互体验
- ✅ 新增详情API接口

## 📞 访问地址

服务器已启动并运行：
- **本地访问**: http://127.0.0.1:5000
- **局域网访问**: http://172.16.42.73:5000

## 📌 注意事项

1. **数据加载**: 服务器启动时会加载所有1175条记录，包含新增字段
2. **字段为空**: 如果某些字段为空，会显示友好的提示信息
3. **链接安全**: 需求文档URL会在新标签打开，避免影响当前页面
4. **格式保留**: 描述和交付物清单保留原始格式（换行、空格等）

---

**最后更新**: 2026-01-27
**版本**: V2.1
**新增功能**: 工作项详情查看
